<!DOCTYPE html>
<html lang="en">
<head>
    <title>CHANGELOG.md</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>
    <div class="banner">
        
        <h1>
            CHANGELOG.md
        </h1>
        <ul class="files">
            
            <li>
                rails/activesupport/CHANGELOG.md
                
                    <a href="https://github.com/rails/rails/blob/45b6b7f57f1a2eb757eb612fcc94e42d5908ec21/activesupport/CHANGELOG.md" target="_blank" class="github_url">on GitHub</a>
                
            </li>
            <li>Last modified: 2019-08-09 23:12:35 +0300</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h2 id="label-Rails+5.2.3+-28March+27-2C+2019-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.3 (March 27, 2019)</h2>
<ul><li>
<p>Add <code>ActiveSupport::HashWithIndifferentAccess#assoc</code>.</p>

<p><code>assoc</code> can now be called with either a string or a symbol.</p>

<p><em>Stefan Schüßler</em></p>
</li><li>
<p>Fix <code>String#safe_constantize</code> throwing a <code>LoadError</code> for incorrectly cased constant references.</p>

<p><em>Keenan Brock</em></p>
</li><li>
<p>Allow Range#=== and Range#cover? on <a href="../../../classes/Range.html"><code>Range</code></a></p>

<p><code>Range#cover?</code> can now accept a range argument like <code>Range#include?</code> and <code>Range#===</code>. <code>Range#===</code> works correctly on Ruby 2.6. <code>Range#include?</code> is moved into a new file, with these two methods.</p>

<p><em>utilum</em></p>
</li><li>
<p>If the same block is <code>included</code> multiple times for a Concern, an exception is no longer raised.</p>

<p><em>Mark J. Titorenko</em>, <em>Vlad Bokov</em></p>
</li></ul>

<h2 id="label-Rails+5.2.2.1+-28March+11-2C+2019-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.2.1 (March 11, 2019)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+5.2.2+-28December+04-2C+2018-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.2 (December 04, 2018)</h2>
<ul><li>
<p>Fix bug where <code>#to_options</code> for <code>ActiveSupport::HashWithIndifferentAccess</code> would not act as alias for <code>#symbolize_keys</code>.</p>

<p><em>Nick Weiland</em></p>
</li><li>
<p>Improve the logic that detects non-autoloaded constants.</p>

<p><em>Jan Habermann</em>, <em>Xavier Noria</em></p>
</li><li>
<p>Fix bug where <code>URI.unescape</code> would fail with mixed Unicode/escaped character input:</p>

<pre><code>URI.unescape(&quot;\xe3\x83\x90&quot;)  # =&gt; &quot;バ&quot;
URI.unescape(&quot;%E3%83%90&quot;)  # =&gt; &quot;バ&quot;
URI.unescape(&quot;\xe3\x83\x90%E3%83%90&quot;)  # =&gt; Encoding::CompatibilityError
</code></pre>

<p><em>Ashe Connor</em>, <em>Aaron Patterson</em></p>
</li></ul>

<h2 id="label-Rails+5.2.1.1+-28November+27-2C+2018-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.1.1 (November 27, 2018)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+5.2.1+-28August+07-2C+2018-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.1 (August 07, 2018)</h2>
<ul><li>
<p>Redis cache store: <code>delete_matched</code> no longer blocks the Redis server. (Switches from evaled Lua to a batched SCAN + DEL loop.)</p>

<p><em>Gleb Mazovetskiy</em></p>
</li><li>
<p>Fix bug where <code>ActiveSupport::Timezone.all</code> would fail when tzinfo data for any timezone defined in <code>ActiveSupport::TimeZone::MAPPING</code> is missing.</p>

<p><em>Dominik Sander</em></p>
</li><li>
<p>Fix bug where <code>ActiveSupport::Cache</code> will massively inflate the storage size when compression is enabled (which is true by default). This patch does not attempt to repair existing data: please manually flush the cache to clear out the problematic entries.</p>

<p><em>Godfrey Chan</em></p>
</li><li>
<p>Fix <code>ActiveSupport::Cache#read_multi</code> bug with local cache enabled that was returning instances of <code>ActiveSupport::Cache::Entry</code> instead of the raw values.</p>

<p><em>Jason Lee</em></p>
</li></ul>

<h2 id="label-Rails+5.2.0+-28April+09-2C+2018-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.0 (April 09, 2018)</h2>
<ul><li>
<p>Caching: MemCache and Redis <code>read_multi</code> and <code>fetch_multi</code> speedup. Read from the local in-memory cache before consulting the backend.</p>

<p><em>Gabriel Sobrinho</em></p>
</li><li>
<p>Return all mappings for a timezone identifier in <code>country_zones</code>.</p>

<p>Some timezones like <code>Europe/London</code> have multiple mappings in <code>ActiveSupport::TimeZone::MAPPING</code> so return all of them instead of the first one found by using <code>Hash#value</code>. e.g:</p>

<pre><code># Before
ActiveSupport::TimeZone.country_zones(&quot;GB&quot;) # =&gt; [&quot;Edinburgh&quot;]

# After
ActiveSupport::TimeZone.country_zones(&quot;GB&quot;) # =&gt; [&quot;Edinburgh&quot;, &quot;London&quot;]
</code></pre>

<p>Fixes #31668.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add support for connection pooling on RedisCacheStore.</p>

<p><em>fatkodima</em></p>
</li><li>
<p>Support hash as first argument in <code>assert_difference</code>. This allows to specify multiple numeric differences in the same assertion.</p>

<pre><code>assert_difference -&gt;{ Article.count } =&gt; 1, -&gt;{ Post.count } =&gt; 2
</code></pre>

<p><em>Julien Meichelbeck</em></p>
</li><li>
<p>Add missing instrumentation for <code>read_multi</code> in <code>ActiveSupport::Cache::Store</code>.</p>

<p><em>Ignatius Reza Lesmana</em></p>
</li><li>
<p><code>assert_changes</code> will always assert that the expression changes, regardless of <code>from:</code> and <code>to:</code> argument combinations.</p>

<p><em>Daniel Ma</em></p>
</li><li>
<p>Use SHA-1 to generate non-sensitive digests, such as the ETag header.</p>

<p>Enabled by default for new apps; upgrading apps can opt in by setting <code>config.active_support.use_sha1_digests = true</code>.</p>

<p><em>Dmitri Dolguikh</em>, <em>Eugene Kenny</em></p>
</li><li>
<p>Changed default behaviour of <code>ActiveSupport::SecurityUtils.secure_compare</code>, to make it not leak length information even for variable length string.</p>

<p>Renamed old <code>ActiveSupport::SecurityUtils.secure_compare</code> to <code>fixed_length_secure_compare</code>, and started raising <code>ArgumentError</code> in case of length mismatch of passed strings.</p>

<p><em>Vipul A M</em></p>
</li><li>
<p>Make <code>ActiveSupport::TimeZone.all</code> return only time zones that are in <code>ActiveSupport::TimeZone::MAPPING</code>.</p>

<p>Fixes #7245.</p>

<p><em>Chris LaRose</em></p>
</li><li>
<p>MemCacheStore: Support expiring counters.</p>

<p>Pass <code>expires_in: [seconds]</code> to <code>#increment</code> and <code>#decrement</code> options to set the Memcached TTL (time-to-live) if the counter doesn&#39;t exist. If the counter exists, Memcached doesn&#39;t extend its expiry when it&#39;s incremented or decremented.</p>

<pre><code>Rails.cache.increment(&quot;my_counter&quot;, 1, expires_in: 2.minutes)
</code></pre>

<p><em>Takumasa Ochi</em></p>
</li><li>
<p>Handle <code>TZInfo::AmbiguousTime</code> errors.</p>

<p>Make <code>ActiveSupport::TimeWithZone</code> match Ruby&#39;s handling of ambiguous times by choosing the later period, e.g.</p>

<p>Ruby: <code> ENV["TZ"] = &quot;Europe/Moscow&quot; Time.local(2014, 10, 26, 1, 0, 0)   # =&gt; 2014-10-26 01:00:00 +0300 </code></p>

<p>Before: <code> &gt;&gt; &quot;2014-10-26 01:00:00&quot;.in_time_zone(&quot;Moscow&quot;) TZInfo::AmbiguousTime: 26/10/2014 01:00 is an ambiguous local time. </code></p>

<p>After: <code> &gt;&gt; &quot;2014-10-26 01:00:00&quot;.in_time_zone(&quot;Moscow&quot;) =&gt; Sun, 26 Oct 2014 01:00:00 MSK +03:00 </code></p>

<p>Fixes #17395.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Redis cache store.</p>

<pre><code># Defaults to `redis://localhost:6379/0`. Only use for dev/test.
config.cache_store = :redis_cache_store

# Supports all common cache store options (:namespace, :compress,
# :compress_threshold, :expires_in, :race_condition_ttl) and all
# Redis options.
cache_password = Rails.application.secrets.redis_cache_password
config.cache_store = :redis_cache_store, driver: :hiredis,
  namespace: &#39;myapp-cache&#39;, compress: true, timeout: 1,
  url: &quot;redis://:#{cache_password}@myapp-cache-1:6379/0&quot;

# Supports Redis::Distributed with multiple hosts
config.cache_store = :redis_cache_store, driver: :hiredis
  namespace: &#39;myapp-cache&#39;, compress: true,
  url: %w[
    redis://myapp-cache-1:6379/0
    redis://myapp-cache-1:6380/0
    redis://myapp-cache-2:6379/0
    redis://myapp-cache-2:6380/0
    redis://myapp-cache-3:6379/0
    redis://myapp-cache-3:6380/0
  ]

# Or pass a builder block
config.cache_store = :redis_cache_store,
  namespace: &#39;myapp-cache&#39;, compress: true,
  redis: -&gt; { Redis.new … }
</code></pre>

<p>Deployment note: Take care to use a <em>dedicated Redis cache</em> rather than pointing this at your existing Redis server. It won&#39;t cope well with mixed usage patterns and it won&#39;t expire cache entries by default.</p>

<p>Redis cache server setup guide: <a href="https://redis.io/topics/lru-cache">redis.io/topics/lru-cache</a></p>

<p><em>Jeremy Daer</em></p>
</li><li>
<p>Cache: Enable compression by default for values &gt; 1kB.</p>

<p>Compression has long been available, but opt-in and at a 16kB threshold. It wasn&#39;t enabled by default due to CPU cost. Today it&#39;s cheap and typical cache data is eminently compressible, such as HTML or JSON fragments. Compression dramatically reduces Memcached/Redis mem usage, which means the same cache servers can store more data, which means higher hit rates.</p>

<p>To disable compression, pass <code>compress: false</code> to the initializer.</p>

<p><em>Jeremy Daer</em></p>
</li><li>
<p>Allow <code>Range#include?</code> on TWZ ranges.</p>

<p>In #11474 we prevented TWZ ranges being iterated over which matched Ruby&#39;s handling of <a href="../../../classes/Time.html"><code>Time</code></a> ranges and as a consequence <code>include?</code> stopped working with both <a href="../../../classes/Time.html"><code>Time</code></a> ranges and TWZ ranges. However in b061634 at <code>ruby/ruby</code> support was added for <code>include?</code> to use <code>cover?</code> for &#39;linear&#39; objects. Since we have no way of making Ruby consider TWZ instances as &#39;linear&#39; we have to override <code>Range#include?</code>.</p>

<p>Fixes #30799.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Fix acronym support in <code>humanize</code>.</p>

<p>Acronym inflections are stored with lowercase keys in the hash but the match wasn&#39;t being lowercased before being looked up in the hash. This shouldn&#39;t have any performance impact because before it would fail to find the acronym and perform the <code>downcase</code> operation anyway.</p>

<p>Fixes #31052.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add same method signature for <code>Time#prev_year</code> and <code>Time#next_year</code> in accordance with <code>Date#prev_year</code>, <code>Date#next_year</code>.</p>

<p>Allows pass argument for <code>Time#prev_year</code> and <code>Time#next_year</code>.</p>

<p>Before: "` Time.new(2017, 9, 16, 17, 0).prev_year # =&gt; 2016-09-16 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).prev_year(1)</p>

<h1 id="label-3D-3E+ArgumentError-3A+wrong+number+of+arguments+-28given+1-2C+expected+0-29">=&gt; ArgumentError: wrong number of arguments (given 1, expected 0)</h1>

<p>Time.new(2017, 9, 16, 17, 0).next_year # =&gt; 2018-09-16 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).next_year(1)</p>

<h1 id="label-3D-3E+ArgumentError-3A+wrong+number+of+arguments+-28given+1-2C+expected+0-29">=&gt; ArgumentError: wrong number of arguments (given 1, expected 0)</h1>

<pre><code>
After:
</code></pre>

<p>Time.new(2017, 9, 16, 17, 0).prev_year # =&gt; 2016-09-16 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).prev_year(1) # =&gt; 2016-09-16 17:00:00 +0300</p>

<p>Time.new(2017, 9, 16, 17, 0).next_year # =&gt; 2018-09-16 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).next_year(1) # =&gt; 2018-09-16 17:00:00 +0300 "`</p>

<p><em>bogdanvlviv</em></p>
</li><li>
<p>Add same method signature for <code>Time#prev_month</code> and <code>Time#next_month</code> in accordance with <code>Date#prev_month</code>, <code>Date#next_month</code>.</p>

<p>Allows pass argument for <code>Time#prev_month</code> and <code>Time#next_month</code>.</p>

<p>Before: "` Time.new(2017, 9, 16, 17, 0).prev_month # =&gt; 2017-08-16 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).prev_month(1)</p>

<h1 id="label-3D-3E+ArgumentError-3A+wrong+number+of+arguments+-28given+1-2C+expected+0-29">=&gt; ArgumentError: wrong number of arguments (given 1, expected 0)</h1>

<p>Time.new(2017, 9, 16, 17, 0).next_month # =&gt; 2017-10-16 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).next_month(1)</p>

<h1 id="label-3D-3E+ArgumentError-3A+wrong+number+of+arguments+-28given+1-2C+expected+0-29">=&gt; ArgumentError: wrong number of arguments (given 1, expected 0)</h1>

<pre><code>
After:
</code></pre>

<p>Time.new(2017, 9, 16, 17, 0).prev_month # =&gt; 2017-08-16 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).prev_month(1) # =&gt; 2017-08-16 17:00:00 +0300</p>

<p>Time.new(2017, 9, 16, 17, 0).next_month # =&gt; 2017-10-16 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).next_month(1) # =&gt; 2017-10-16 17:00:00 +0300 "`</p>

<p><em>bogdanvlviv</em></p>
</li><li>
<p>Add same method signature for <code>Time#prev_day</code> and <code>Time#next_day</code> in accordance with <code>Date#prev_day</code>, <code>Date#next_day</code>.</p>

<p>Allows pass argument for <code>Time#prev_day</code> and <code>Time#next_day</code>.</p>

<p>Before: "` Time.new(2017, 9, 16, 17, 0).prev_day # =&gt; 2017-09-15 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).prev_day(1)</p>

<h1 id="label-3D-3E+ArgumentError-3A+wrong+number+of+arguments+-28given+1-2C+expected+0-29">=&gt; ArgumentError: wrong number of arguments (given 1, expected 0)</h1>

<p>Time.new(2017, 9, 16, 17, 0).next_day # =&gt; 2017-09-17 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).next_day(1)</p>

<h1 id="label-3D-3E+ArgumentError-3A+wrong+number+of+arguments+-28given+1-2C+expected+0-29">=&gt; ArgumentError: wrong number of arguments (given 1, expected 0)</h1>

<pre><code>
After:
</code></pre>

<p>Time.new(2017, 9, 16, 17, 0).prev_day # =&gt; 2017-09-15 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).prev_day(1) # =&gt; 2017-09-15 17:00:00 +0300</p>

<p>Time.new(2017, 9, 16, 17, 0).next_day # =&gt; 2017-09-17 17:00:00 +0300 Time.new(2017, 9, 16, 17, 0).next_day(1) # =&gt; 2017-09-17 17:00:00 +0300 "`</p>

<p><em>bogdanvlviv</em></p>
</li><li>
<p><code>IO#to_json</code> now returns the <code>to_s</code> representation, rather than attempting to convert to an array. This fixes a bug where <code>IO#to_json</code> would raise an <code>IOError</code> when called on an unreadable object.</p>

<p>Fixes #26132.</p>

<p><em>Paul Kuruvilla</em></p>
</li><li>
<p>Remove deprecated <code>halt_callback_chains_on_return_false</code> option.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Remove deprecated <code>:if</code> and <code>:unless</code> string filter for callbacks.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p><code>Hash#slice</code> now falls back to Ruby 2.5+&#39;s built-in definition if defined.</p>

<p><em>Akira Matsuda</em></p>
</li><li>
<p>Deprecate <code>secrets.secret_token</code>.</p>

<p>The architecture for secrets had a big upgrade between <a href="../../../classes/Rails.html"><code>Rails</code></a> 3 and <a href="../../../classes/Rails.html"><code>Rails</code></a> 4, when the default changed from using <code>secret_token</code> to <code>secret_key_base</code>.</p>

<p><code>secret_token</code> has been soft deprecated in documentation for four years but is still in place to support apps created before <a href="../../../classes/Rails.html"><code>Rails</code></a> 4. Deprecation warnings have been added to help developers upgrade their applications to <code>secret_key_base</code>.</p>

<p><em>claudiob</em>, <em>Kasper Timm Hansen</em></p>
</li><li>
<p>Return an instance of <code>HashWithIndifferentAccess</code> from <code>HashWithIndifferentAccess#transform_keys</code>.</p>

<p><em>Yuji Yaginuma</em></p>
</li><li>
<p>Add key rotation support to <code>MessageEncryptor</code> and <code>MessageVerifier</code>.</p>

<p>This change introduces a <code>rotate</code> method to both the <code>MessageEncryptor</code> and <code>MessageVerifier</code> classes. This method accepts the same arguments and options as the given classes&#39; constructor. The <code>encrypt_and_verify</code> method for <code>MessageEncryptor</code> and the <code>verified</code> method for <code>MessageVerifier</code> also accept an optional keyword argument <code>:on_rotation</code> block which is called when a rotated instance is used to decrypt or verify the message.</p>

<p><em>Michael J Coyne</em></p>
</li><li>
<p>Deprecate <code>Module#reachable?</code> method.</p>

<p><em>bogdanvlviv</em></p>
</li><li>
<p>Add <code>config/credentials.yml.enc</code> to store production app secrets.</p>

<p>Allows saving any authentication credentials for third party services directly in repo encrypted with <code>config/master.key</code> or <code>ENV["RAILS_MASTER_KEY"]</code>.</p>

<p>This will eventually replace <code>Rails.application.secrets</code> and the encrypted secrets introduced in <a href="../../../classes/Rails.html"><code>Rails</code></a> 5.1.</p>

<p><em>DHH</em>, <em>Kasper Timm Hansen</em></p>
</li><li>
<p>Add <code>ActiveSupport::EncryptedFile</code> and <code>ActiveSupport::EncryptedConfiguration</code>.</p>

<p>Allows for stashing encrypted files or configuration directly in repo by encrypting it with a key.</p>

<p>Backs the new credentials setup above, but can also be used independently.</p>

<p><em>DHH</em>, <em>Kasper Timm Hansen</em></p>
</li><li>
<p><code>Module#delegate_missing_to</code> now raises <code>DelegationError</code> if target is nil, similar to <code>Module#delegate</code>.</p>

<p><em>Anton Khamets</em></p>
</li><li>
<p>Update <code>String#camelize</code> to provide feedback when wrong option is passed.</p>

<p><code>String#camelize</code> was returning nil without any feedback when an invalid option was passed as a parameter.</p>

<p>Previously:</p>

<pre><code>&#39;one_two&#39;.camelize(true)
# =&gt; nil
</code></pre>

<p>Now:</p>

<pre><code>&#39;one_two&#39;.camelize(true)
# =&gt; ArgumentError: Invalid option, use either :upper or :lower.
</code></pre>

<p><em>Ricardo Díaz</em></p>
</li><li>
<p>Fix modulo operations involving durations.</p>

<p><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.1 introduced <code>ActiveSupport::Duration::Scalar</code> as a wrapper around numeric values as a way of ensuring a duration was the outcome of an expression. However, the implementation was missing support for modulo operations. This support has now been added and should result in a duration being returned from expressions involving modulo operations.</p>

<p>Prior to <a href="../../../classes/Rails.html"><code>Rails</code></a> 5.1:</p>

<pre><code>5.minutes % 2.minutes
# =&gt; 60
</code></pre>

<p>Now:</p>

<pre><code>5.minutes % 2.minutes
# =&gt; 1 minute
</code></pre>

<p>Fixes #29603 and #29743.</p>

<p><em>Sayan Chakraborty</em>, <em>Andrew White</em></p>
</li><li>
<p>Fix division where a duration is the denominator.</p>

<p>PR #29163 introduced a change in behavior when a duration was the denominator in a calculation - this was incorrect as dividing by a duration should always return a <code>Numeric</code>. The behavior of previous versions of <a href="../../../classes/Rails.html"><code>Rails</code></a> has been restored.</p>

<p>Fixes #29592.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add purpose and expiry support to <code>ActiveSupport::MessageVerifier</code> and  <code>ActiveSupport::MessageEncryptor</code>.</p>

<p>For instance, to ensure a message is only usable for one intended purpose:</p>

<pre><code>token = @verifier.generate(&quot;x&quot;, purpose: :shipping)

@verifier.verified(token, purpose: :shipping) # =&gt; &quot;x&quot;
@verifier.verified(token)                     # =&gt; nil
</code></pre>

<p>Or make it expire after a set time:</p>

<pre><code>@verifier.generate(&quot;x&quot;, expires_in: 1.month)
@verifier.generate(&quot;y&quot;, expires_at: Time.now.end_of_year)
</code></pre>

<p>Showcased with <code>ActiveSupport::MessageVerifier</code>, but works the same for <code>ActiveSupport::MessageEncryptor</code>&#39;s <code>encrypt_and_sign</code> and <code>decrypt_and_verify</code>.</p>

<p>Pull requests: #29599, #29854</p>

<p><em>Assain Jaleel</em></p>
</li><li>
<p>Make the order of <code>Hash#reverse_merge!</code> consistent with <code>HashWithIndifferentAccess</code>.</p>

<p><em>Erol Fornoles</em></p>
</li><li>
<p>Add <code>freeze_time</code> helper which freezes time to <code>Time.now</code> in tests.</p>

<p><em>Prathamesh Sonpatki</em></p>
</li><li>
<p>Default <code>ActiveSupport::MessageEncryptor</code> to use AES 256 GCM encryption.</p>

<p>On for new <a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2 apps. Upgrading apps can find the config as a new framework default.</p>

<p><em>Assain Jaleel</em></p>
</li><li>
<p>Cache: <code>write_multi</code>.</p>

<pre><code>Rails.cache.write_multi foo: &#39;bar&#39;, baz: &#39;qux&#39;
</code></pre>

<p>Plus faster fetch_multi with stores that implement <code>write_multi_entries</code>. Keys that aren&#39;t found may be written to the cache store in one shot instead of separate writes.</p>

<p>The default implementation simply calls <code>write_entry</code> for each entry. Stores may override if they&#39;re capable of one-shot bulk writes, like Redis <code>MSET</code>.</p>

<p><em>Jeremy Daer</em></p>
</li><li>
<p>Add default option to module and class attribute accessors.</p>

<pre><code>mattr_accessor :settings, default: {}
</code></pre>

<p>Works for <code>mattr_reader</code>, <code>mattr_writer</code>, <code>cattr_accessor</code>, <code>cattr_reader</code>, and <code>cattr_writer</code> as well.</p>

<p><em>Genadi Samokovarov</em></p>
</li><li>
<p>Add <code>Date#prev_occurring</code> and <code>Date#next_occurring</code> to return specified next/previous occurring day of week.</p>

<p><em>Shota Iguchi</em></p>
</li><li>
<p>Add default option to <code>class_attribute</code>.</p>

<p>Before:</p>

<pre><code>class_attribute :settings
self.settings = {}
</code></pre>

<p>Now:</p>

<pre><code>class_attribute :settings, default: {}
</code></pre>

<p><em>DHH</em></p>
</li><li>
<p><code>#singularize</code> and <code>#pluralize</code> now respect uncountables for the specified locale.</p>

<p><em>Eilis Hamilton</em></p>
</li><li>
<p>Add <code>ActiveSupport::CurrentAttributes</code> to provide a thread-isolated attributes singleton. Primary use case is keeping all the per-request attributes easily available to the whole system.</p>

<p><em>DHH</em></p>
</li><li>
<p>Fix implicit coercion calculations with scalars and durations.</p>

<p>Previously, calculations where the scalar is first would be converted to a duration of seconds, but this causes issues with dates being converted to times, e.g:</p>

<pre><code>Time.zone = &quot;Beijing&quot;           # =&gt; Asia/Shanghai
date = Date.civil(2017, 5, 20)  # =&gt; Mon, 20 May 2017
2 * 1.day                       # =&gt; 172800 seconds
date + 2 * 1.day                # =&gt; Mon, 22 May 2017 00:00:00 CST +08:00
</code></pre>

<p>Now, the <code>ActiveSupport::Duration::Scalar</code> calculation methods will try to maintain the part structure of the duration where possible, e.g:</p>

<pre><code>Time.zone = &quot;Beijing&quot;           # =&gt; Asia/Shanghai
date = Date.civil(2017, 5, 20)  # =&gt; Mon, 20 May 2017
2 * 1.day                       # =&gt; 2 days
date + 2 * 1.day                # =&gt; Mon, 22 May 2017
</code></pre>

<p>Fixes #29160, #28970.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add support for versioned cache entries. This enables the cache stores to recycle cache keys, greatly saving on storage in cases with frequent churn. Works together with the separation of <code>#cache_key</code> and <code>#cache_version</code> in Active Record and its use in Action Pack&#39;s fragment caching.</p>

<p><em>DHH</em></p>
</li><li>
<p>Pass gem name and deprecation horizon to deprecation notifications.</p>

<p><em>Willem van Bergen</em></p>
</li><li>
<p>Add support for <code>:offset</code> and <code>:zone</code> to <code>ActiveSupport::TimeWithZone#change</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add support for <code>:offset</code> to <code>Time#change</code>.</p>

<p>Fixes #28723.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add <code>fetch_values</code> for <code>HashWithIndifferentAccess</code>.</p>

<p>The method was originally added to <code>Hash</code> in Ruby 2.3.0.</p>

<p><em>Josh Pencheon</em></p>
</li></ul>

<p>Please check <a href="https://github.com/rails/rails/blob/5-1-stable/activesupport/CHANGELOG.md">5-1-stable</a> for previous changes.</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
    
    
    
  
</div>

    </div>
  </body>
</html>
