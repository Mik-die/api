<!DOCTYPE html>
<html lang="en">
<head>
    <title>Rakefile</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>
    <div class="banner">
        
        <h1>
            Rakefile
        </h1>
        <ul class="files">
            
            <li>
                rails/railties/Rakefile
                
                    <a href="https://github.com/rails/rails/blob/45b6b7f57f1a2eb757eb612fcc94e42d5908ec21/railties/Rakefile" target="_blank" class="github_url">on GitHub</a>
                
            </li>
            <li>Last modified: 2019-08-09 23:12:35 +0300</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p># frozen_string_literal: true</p>

<p>require “rake/testtask”</p>

<p>task default: :test</p>

<p>task :package</p>

<p>desc “Run all unit tests” task test: “test:isolated”</p>

<p>namespace :test do</p>

<pre><code>task :isolated do
  dash_i = [
    &quot;test&quot;,
    &quot;lib&quot;,
    &quot;../activesupport/lib&quot;,
    &quot;../actionpack/lib&quot;,
    &quot;../actionview/lib&quot;,
    &quot;../activemodel/lib&quot;
  ].map { |dir| File.expand_path(dir, __dir__) }

  dash_i.reverse_each do |x|
    $:.unshift(x) unless $:.include?(x)
  end
  $-w = true

  require &quot;bundler/setup&quot; unless defined?(Bundler)
  require &quot;active_support&quot;

  failing_files = []

  dirs = (ENV[&quot;TEST_DIR&quot;] || ENV[&quot;TEST_DIRS&quot;] || &quot;**&quot;).split(&quot;,&quot;)
  test_files = dirs.map { |dir| &quot;test/#{dir}  _test.rb&quot; }
  Dir[*test_files].each do |file|
    next true if file.start_with?(&quot;test/fixtures/&quot;)

    fake_command = Shellwords.join([
      FileUtils::RUBY,
      &quot;-w&quot;,
       dash_i.map { |dir| &quot;-I#{Pathname.new(dir).relative_path_from(Pathname.pwd)}&quot; },
      file,
    ])
    puts fake_command

    # We could run these in parallel, but pretty much all of the
    # railties tests already run in parallel, so ¯\_(⊙︿⊙)_/¯
    Process.waitpid fork {
      ARGV.clear
      Rake.application = nil

      load file
    }

    unless $?.success?
      failing_files &lt;&lt; file
    end
  end

  unless failing_files.empty?
    puts
    puts &quot;Failed in:&quot;
    failing_files.each do |file|
      puts &quot;  #{file}&quot;
    end
    puts

    raise &quot;Failure in isolated test runner&quot;
  end
end
</code></pre>

<p>end</p>

<p>Rake::TestTask.new(“test:regular”) do |t|</p>

<pre><code>t.libs &lt;&lt; &quot;test&quot; &lt;&lt; &quot;#{__dir__}/../activesupport/lib&quot;
t.pattern = &quot;test/   *_test.rb&quot;
t.warning = false
t.verbose = true
t.ruby_opts = [&quot;--dev&quot;] if defined?(JRUBY_VERSION)
</code></pre>

<p>end</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
    
    
    
  
</div>

    </div>
  </body>
</html>
